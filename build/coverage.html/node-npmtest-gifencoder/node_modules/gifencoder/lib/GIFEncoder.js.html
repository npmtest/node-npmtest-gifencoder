<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-gifencoder/node_modules/gifencoder/lib/GIFEncoder.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-gifencoder">npmtest-gifencoder (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-gifencoder/node_modules/gifencoder/lib/GIFEncoder.js</span></h1>
    <h2>
        
        Statements: <span class="metric">15.07% <small>(33 / 219)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 42)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 36)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">15.57% <small>(33 / 212)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-gifencoder/node_modules/gifencoder/lib/</a> &#187; GIFEncoder.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/*
  GIFEncoder.js
&nbsp;
  Authors
  Kevin Weiner (original Java version - kweiner@fmsware.com)
  Thibault Imbert (AS3 version - bytearray.org)
  Johan Nordberg (JS version - code@johan-nordberg.com)
  Eugene Ware (node.js streaming version - eugene@noblesmaurai.com)
*/
&nbsp;
var stream = require('stream');
var NeuQuant = require('./TypedNeuQuant.js');
var LZWEncoder = require('./LZWEncoder.js');
&nbsp;
<span class="fstat-no" title="function not covered" >function ByteArray() {</span>
<span class="cstat-no" title="statement not covered" >  this.data = [];</span>
}
&nbsp;
ByteArray.prototype.getData = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >  return new Buffer(this.data);</span>
};
&nbsp;
ByteArray.prototype.writeByte = <span class="fstat-no" title="function not covered" >function(val) {</span>
<span class="cstat-no" title="statement not covered" >  this.data.push(val);</span>
};
&nbsp;
ByteArray.prototype.writeUTFBytes = <span class="fstat-no" title="function not covered" >function(string) {</span>
<span class="cstat-no" title="statement not covered" >  for (var l = string.length, i = 0; i &lt; l; i++)</span>
<span class="cstat-no" title="statement not covered" >    this.writeByte(string.charCodeAt(i));</span>
};
&nbsp;
ByteArray.prototype.writeBytes = <span class="fstat-no" title="function not covered" >function(array, offset, length) {</span>
<span class="cstat-no" title="statement not covered" >  for (var l = length || array.length, i = offset || 0; i &lt; l; i++)</span>
<span class="cstat-no" title="statement not covered" >    this.writeByte(array[i]);</span>
};
&nbsp;
<span class="fstat-no" title="function not covered" >function GIFEncoder(width, height) {</span>
  // image size
<span class="cstat-no" title="statement not covered" >  this.width = ~~width;</span>
<span class="cstat-no" title="statement not covered" >  this.height = ~~height;</span>
&nbsp;
  // transparent color if given
<span class="cstat-no" title="statement not covered" >  this.transparent = null;</span>
&nbsp;
  // transparent index in color table
<span class="cstat-no" title="statement not covered" >  this.transIndex = 0;</span>
&nbsp;
  // -1 = no repeat, 0 = forever. anything else is repeat count
<span class="cstat-no" title="statement not covered" >  this.repeat = -1;</span>
&nbsp;
  // frame delay (hundredths)
<span class="cstat-no" title="statement not covered" >  this.delay = 0;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.image = null; </span>// current frame
<span class="cstat-no" title="statement not covered" >  this.pixels = null; </span>// BGR byte array from frame
<span class="cstat-no" title="statement not covered" >  this.indexedPixels = null; </span>// converted frame indexed to palette
<span class="cstat-no" title="statement not covered" >  this.colorDepth = null; </span>// number of bit planes
<span class="cstat-no" title="statement not covered" >  this.colorTab = null; </span>// RGB palette
<span class="cstat-no" title="statement not covered" >  this.usedEntry = new Array(); </span>// active palette entries
<span class="cstat-no" title="statement not covered" >  this.palSize = 7; </span>// color table size (bits-1)
<span class="cstat-no" title="statement not covered" >  this.dispose = -1; </span>// disposal code (-1 = use default)
<span class="cstat-no" title="statement not covered" >  this.firstFrame = true;</span>
<span class="cstat-no" title="statement not covered" >  this.sample = 10; </span>// default sample interval for quantizer
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.started = false; </span>// started encoding
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.readStreams = [];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.out = new ByteArray();</span>
}
&nbsp;
GIFEncoder.prototype.createReadStream = <span class="fstat-no" title="function not covered" >function (rs) {</span>
<span class="cstat-no" title="statement not covered" >  if (!rs) {</span>
<span class="cstat-no" title="statement not covered" >    rs = new stream.Readable();</span>
<span class="cstat-no" title="statement not covered" >    rs._read = <span class="fstat-no" title="function not covered" >function () {</span>};</span>
  }
<span class="cstat-no" title="statement not covered" >  this.readStreams.push(rs);</span>
<span class="cstat-no" title="statement not covered" >  return rs;</span>
};
&nbsp;
GIFEncoder.prototype.createWriteStream = <span class="fstat-no" title="function not covered" >function (options) {</span>
<span class="cstat-no" title="statement not covered" >  var self = this;</span>
<span class="cstat-no" title="statement not covered" >  if (options) {</span>
<span class="cstat-no" title="statement not covered" >    Object.keys(options).forEach(<span class="fstat-no" title="function not covered" >function (option) {</span></span>
<span class="cstat-no" title="statement not covered" >      var fn = 'set' + option[0].toUpperCase() + option.substr(1);</span>
<span class="cstat-no" title="statement not covered" >      if (~['setDelay', 'setFrameRate', 'setDispose', 'setRepeat',</span>
           'setTransparent', 'setQuality'].indexOf(fn)) {
<span class="cstat-no" title="statement not covered" >        self[fn].call(self, options[option]);</span>
      }
    });
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  var ws = new stream.Duplex({ objectMode: true });</span>
<span class="cstat-no" title="statement not covered" >  ws._read = <span class="fstat-no" title="function not covered" >function () {</span>};</span>
<span class="cstat-no" title="statement not covered" >  this.createReadStream(ws);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var self = this;</span>
<span class="cstat-no" title="statement not covered" >  ws._write = <span class="fstat-no" title="function not covered" >function (data, enc, next) {</span></span>
<span class="cstat-no" title="statement not covered" >    if (!self.started) <span class="cstat-no" title="statement not covered" >self.start();</span></span>
<span class="cstat-no" title="statement not covered" >    self.addFrame(data);</span>
<span class="cstat-no" title="statement not covered" >    next();</span>
  };
<span class="cstat-no" title="statement not covered" >  var end = ws.end;</span>
<span class="cstat-no" title="statement not covered" >  ws.end = <span class="fstat-no" title="function not covered" >function () {</span></span>
<span class="cstat-no" title="statement not covered" >    end.apply(ws, [].slice.call(arguments));</span>
<span class="cstat-no" title="statement not covered" >    self.finish();</span>
  };
<span class="cstat-no" title="statement not covered" >  return ws;</span>
};
&nbsp;
GIFEncoder.prototype.emit = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >  var self = this;</span>
<span class="cstat-no" title="statement not covered" >  if (this.readStreams.length === 0) <span class="cstat-no" title="statement not covered" >return;</span></span>
<span class="cstat-no" title="statement not covered" >  if (this.out.data.length) {</span>
<span class="cstat-no" title="statement not covered" >    this.readStreams.forEach(<span class="fstat-no" title="function not covered" >function (rs) {</span></span>
<span class="cstat-no" title="statement not covered" >      rs.push(new Buffer(self.out.data));</span>
    });
<span class="cstat-no" title="statement not covered" >    this.out.data = [];</span>
  }
};
&nbsp;
GIFEncoder.prototype.end = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >  if (this.readStreams.length === null) <span class="cstat-no" title="statement not covered" >return;</span></span>
<span class="cstat-no" title="statement not covered" >  this.emit();</span>
<span class="cstat-no" title="statement not covered" >  this.readStreams.forEach(<span class="fstat-no" title="function not covered" >function (rs) {</span></span>
<span class="cstat-no" title="statement not covered" >    rs.push(null);</span>
  });
<span class="cstat-no" title="statement not covered" >  this.readStreams = [];</span>
};
&nbsp;
/*
  Sets the delay time between each frame, or changes it for subsequent frames
  (applies to the next frame added)
*/
GIFEncoder.prototype.setDelay = <span class="fstat-no" title="function not covered" >function(milliseconds) {</span>
<span class="cstat-no" title="statement not covered" >  this.delay = Math.round(milliseconds / 10);</span>
};
&nbsp;
/*
  Sets frame rate in frames per second.
*/
GIFEncoder.prototype.setFrameRate = <span class="fstat-no" title="function not covered" >function(fps) {</span>
<span class="cstat-no" title="statement not covered" >  this.delay = Math.round(100 / fps);</span>
};
&nbsp;
/*
  Sets the GIF frame disposal code for the last added frame and any
  subsequent frames.
&nbsp;
  Default is 0 if no transparent color has been set, otherwise 2.
*/
GIFEncoder.prototype.setDispose = <span class="fstat-no" title="function not covered" >function(disposalCode) {</span>
<span class="cstat-no" title="statement not covered" >  if (disposalCode &gt;= 0) <span class="cstat-no" title="statement not covered" >this.dispose = disposalCode;</span></span>
};
&nbsp;
/*
  Sets the number of times the set of GIF frames should be played.
&nbsp;
  -1 = play once
  0 = repeat indefinitely
&nbsp;
  Default is -1
&nbsp;
  Must be invoked before the first image is added
*/
&nbsp;
GIFEncoder.prototype.setRepeat = <span class="fstat-no" title="function not covered" >function(repeat) {</span>
<span class="cstat-no" title="statement not covered" >  this.repeat = repeat;</span>
};
&nbsp;
/*
  Sets the transparent color for the last added frame and any subsequent
  frames. Since all colors are subject to modification in the quantization
  process, the color in the final palette for each frame closest to the given
  color becomes the transparent color for that frame. May be set to null to
  indicate no transparent color.
*/
GIFEncoder.prototype.setTransparent = <span class="fstat-no" title="function not covered" >function(color) {</span>
<span class="cstat-no" title="statement not covered" >  this.transparent = color;</span>
};
&nbsp;
/*
  Adds next GIF frame. The frame is not written immediately, but is
  actually deferred until the next frame is received so that timing
  data can be inserted.  Invoking finish() flushes all frames.
*/
GIFEncoder.prototype.addFrame = <span class="fstat-no" title="function not covered" >function(imageData) {</span>
  // HTML Canvas 2D Context Passed In
<span class="cstat-no" title="statement not covered" >  if (imageData &amp;&amp; imageData.getImageData) {</span>
<span class="cstat-no" title="statement not covered" >    this.image = imageData.getImageData(0, 0, this.width, this.height).data;</span>
  } else {
<span class="cstat-no" title="statement not covered" >    this.image = imageData;</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.getImagePixels(); </span>// convert to correct format if necessary
<span class="cstat-no" title="statement not covered" >  this.analyzePixels(); </span>// build color table &amp; map pixels
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (this.firstFrame) {</span>
<span class="cstat-no" title="statement not covered" >    this.writeLSD(); </span>// logical screen descriptior
<span class="cstat-no" title="statement not covered" >    this.writePalette(); </span>// global color table
<span class="cstat-no" title="statement not covered" >    if (this.repeat &gt;= 0) {</span>
      // use NS app extension to indicate reps
<span class="cstat-no" title="statement not covered" >      this.writeNetscapeExt();</span>
    }
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.writeGraphicCtrlExt(); </span>// write graphic control extension
<span class="cstat-no" title="statement not covered" >  this.writeImageDesc(); </span>// image descriptor
<span class="cstat-no" title="statement not covered" >  if (!this.firstFrame) <span class="cstat-no" title="statement not covered" >this.writePalette(); </span></span>// local color table
<span class="cstat-no" title="statement not covered" >  this.writePixels(); </span>// encode and write pixel data
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.firstFrame = false;</span>
<span class="cstat-no" title="statement not covered" >  this.emit();</span>
};
&nbsp;
/*
  Adds final trailer to the GIF stream, if you don't call the finish method
  the GIF stream will not be valid.
*/
GIFEncoder.prototype.finish = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(0x3b); </span>// gif trailer
<span class="cstat-no" title="statement not covered" >  this.end();</span>
};
&nbsp;
/*
  Sets quality of color quantization (conversion of images to the maximum 256
  colors allowed by the GIF specification). Lower values (minimum = 1)
  produce better colors, but slow processing significantly. 10 is the
  default, and produces good color mapping at reasonable speeds. Values
  greater than 20 do not yield significant improvements in speed.
*/
GIFEncoder.prototype.setQuality = <span class="fstat-no" title="function not covered" >function(quality) {</span>
<span class="cstat-no" title="statement not covered" >  if (quality &lt; 1) <span class="cstat-no" title="statement not covered" >quality = 1;</span></span>
<span class="cstat-no" title="statement not covered" >  this.sample = quality;</span>
};
&nbsp;
/*
  Writes GIF file header
*/
GIFEncoder.prototype.start = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >  this.out.writeUTFBytes("GIF89a");</span>
<span class="cstat-no" title="statement not covered" >  this.started = true;</span>
<span class="cstat-no" title="statement not covered" >  this.emit();</span>
};
&nbsp;
/*
  Analyzes current frame colors and creates color map.
*/
GIFEncoder.prototype.analyzePixels = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >  var len = this.pixels.length;</span>
<span class="cstat-no" title="statement not covered" >  var nPix = len / 3;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.indexedPixels = new Uint8Array(nPix);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var imgq = new NeuQuant(this.pixels, this.sample);</span>
<span class="cstat-no" title="statement not covered" >  imgq.buildColormap(); </span>// create reduced palette
<span class="cstat-no" title="statement not covered" >  this.colorTab = imgq.getColormap();</span>
&nbsp;
  // map image pixels to new palette
<span class="cstat-no" title="statement not covered" >  var k = 0;</span>
<span class="cstat-no" title="statement not covered" >  for (var j = 0; j &lt; nPix; j++) {</span>
<span class="cstat-no" title="statement not covered" >    var index = imgq.lookupRGB(</span>
      this.pixels[k++] &amp; 0xff,
      this.pixels[k++] &amp; 0xff,
      this.pixels[k++] &amp; 0xff
    );
<span class="cstat-no" title="statement not covered" >    this.usedEntry[index] = true;</span>
<span class="cstat-no" title="statement not covered" >    this.indexedPixels[j] = index;</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.pixels = null;</span>
<span class="cstat-no" title="statement not covered" >  this.colorDepth = 8;</span>
<span class="cstat-no" title="statement not covered" >  this.palSize = 7;</span>
&nbsp;
  // get closest match to transparent color if specified
<span class="cstat-no" title="statement not covered" >  if (this.transparent !== null) {</span>
<span class="cstat-no" title="statement not covered" >    this.transIndex = this.findClosest(this.transparent);</span>
  }
};
&nbsp;
/*
  Returns index of palette color closest to c
*/
GIFEncoder.prototype.findClosest = <span class="fstat-no" title="function not covered" >function(c) {</span>
<span class="cstat-no" title="statement not covered" >  if (this.colorTab === null) <span class="cstat-no" title="statement not covered" >return -1;</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var r = (c &amp; 0xFF0000) &gt;&gt; 16;</span>
<span class="cstat-no" title="statement not covered" >  var g = (c &amp; 0x00FF00) &gt;&gt; 8;</span>
<span class="cstat-no" title="statement not covered" >  var b = (c &amp; 0x0000FF);</span>
<span class="cstat-no" title="statement not covered" >  var minpos = 0;</span>
<span class="cstat-no" title="statement not covered" >  var dmin = 256 * 256 * 256;</span>
<span class="cstat-no" title="statement not covered" >  var len = this.colorTab.length;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  for (var i = 0; i &lt; len;) {</span>
<span class="cstat-no" title="statement not covered" >    var dr = r - (this.colorTab[i++] &amp; 0xff);</span>
<span class="cstat-no" title="statement not covered" >    var dg = g - (this.colorTab[i++] &amp; 0xff);</span>
<span class="cstat-no" title="statement not covered" >    var db = b - (this.colorTab[i] &amp; 0xff);</span>
<span class="cstat-no" title="statement not covered" >    var d = dr * dr + dg * dg + db * db;</span>
<span class="cstat-no" title="statement not covered" >    var index = i / 3;</span>
<span class="cstat-no" title="statement not covered" >    if (this.usedEntry[index] &amp;&amp; (d &lt; dmin)) {</span>
<span class="cstat-no" title="statement not covered" >      dmin = d;</span>
<span class="cstat-no" title="statement not covered" >      minpos = index;</span>
    }
<span class="cstat-no" title="statement not covered" >    i++;</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  return minpos;</span>
};
&nbsp;
/*
  Extracts image pixels into byte array pixels
  (removes alphachannel from canvas imagedata)
*/
GIFEncoder.prototype.getImagePixels = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >  var w = this.width;</span>
<span class="cstat-no" title="statement not covered" >  var h = this.height;</span>
<span class="cstat-no" title="statement not covered" >  this.pixels = new Uint8Array(w * h * 3);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var data = this.image;</span>
<span class="cstat-no" title="statement not covered" >  var count = 0;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  for (var i = 0; i &lt; h; i++) {</span>
<span class="cstat-no" title="statement not covered" >    for (var j = 0; j &lt; w; j++) {</span>
<span class="cstat-no" title="statement not covered" >      var b = (i * w * 4) + j * 4;</span>
<span class="cstat-no" title="statement not covered" >      this.pixels[count++] = data[b];</span>
<span class="cstat-no" title="statement not covered" >      this.pixels[count++] = data[b+1];</span>
<span class="cstat-no" title="statement not covered" >      this.pixels[count++] = data[b+2];</span>
    }
  }
};
&nbsp;
/*
  Writes Graphic Control Extension
*/
GIFEncoder.prototype.writeGraphicCtrlExt = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(0x21); </span>// extension introducer
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(0xf9); </span>// GCE label
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(4); </span>// data block size
&nbsp;
<span class="cstat-no" title="statement not covered" >  var transp, disp;</span>
<span class="cstat-no" title="statement not covered" >  if (this.transparent === null) {</span>
<span class="cstat-no" title="statement not covered" >    transp = 0;</span>
<span class="cstat-no" title="statement not covered" >    disp = 0; </span>// dispose = no action
  } else {
<span class="cstat-no" title="statement not covered" >    transp = 1;</span>
<span class="cstat-no" title="statement not covered" >    disp = 2; </span>// force clear if using transparent color
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (this.dispose &gt;= 0) {</span>
<span class="cstat-no" title="statement not covered" >    disp = this.dispose &amp; 7; </span>// user override
  }
<span class="cstat-no" title="statement not covered" >  disp &lt;&lt;= 2;</span>
&nbsp;
  // packed fields
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(</span>
    0 | // 1:3 reserved
    disp | // 4:6 disposal
    0 | // 7 user input - 0 = none
    transp // 8 transparency flag
  );
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.writeShort(this.delay); </span>// delay x 1/100 sec
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(this.transIndex); </span>// transparent color index
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(0); </span>// block terminator
};
&nbsp;
/*
  Writes Image Descriptor
*/
GIFEncoder.prototype.writeImageDesc = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(0x2c); </span>// image separator
<span class="cstat-no" title="statement not covered" >  this.writeShort(0); </span>// image position x,y = 0,0
<span class="cstat-no" title="statement not covered" >  this.writeShort(0);</span>
<span class="cstat-no" title="statement not covered" >  this.writeShort(this.width); </span>// image size
<span class="cstat-no" title="statement not covered" >  this.writeShort(this.height);</span>
&nbsp;
  // packed fields
<span class="cstat-no" title="statement not covered" >  if (this.firstFrame) {</span>
    // no LCT - GCT is used for first (or only) frame
<span class="cstat-no" title="statement not covered" >    this.out.writeByte(0);</span>
  } else {
    // specify normal LCT
<span class="cstat-no" title="statement not covered" >    this.out.writeByte(</span>
      0x80 | // 1 local color table 1=yes
      0 | // 2 interlace - 0=no
      0 | // 3 sorted - 0=no
      0 | // 4-5 reserved
      this.palSize // 6-8 size of color table
    );
  }
};
&nbsp;
/*
  Writes Logical Screen Descriptor
*/
GIFEncoder.prototype.writeLSD = <span class="fstat-no" title="function not covered" >function() {</span>
  // logical screen size
<span class="cstat-no" title="statement not covered" >  this.writeShort(this.width);</span>
<span class="cstat-no" title="statement not covered" >  this.writeShort(this.height);</span>
&nbsp;
  // packed fields
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(</span>
    0x80 | // 1 : global color table flag = 1 (gct used)
    0x70 | // 2-4 : color resolution = 7
    0x00 | // 5 : gct sort flag = 0
    this.palSize // 6-8 : gct size
  );
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(0); </span>// background color index
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(0); </span>// pixel aspect ratio - assume 1:1
};
&nbsp;
/*
  Writes Netscape application extension to define repeat count.
*/
GIFEncoder.prototype.writeNetscapeExt = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(0x21); </span>// extension introducer
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(0xff); </span>// app extension label
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(11); </span>// block size
<span class="cstat-no" title="statement not covered" >  this.out.writeUTFBytes('NETSCAPE2.0'); </span>// app id + auth code
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(3); </span>// sub-block size
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(1); </span>// loop sub-block id
<span class="cstat-no" title="statement not covered" >  this.writeShort(this.repeat); </span>// loop count (extra iterations, 0=repeat forever)
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(0); </span>// block terminator
};
&nbsp;
/*
  Writes color table
*/
GIFEncoder.prototype.writePalette = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >  this.out.writeBytes(this.colorTab);</span>
<span class="cstat-no" title="statement not covered" >  var n = (3 * 256) - this.colorTab.length;</span>
<span class="cstat-no" title="statement not covered" >  for (var i = 0; i &lt; n; i++)</span>
<span class="cstat-no" title="statement not covered" >    this.out.writeByte(0);</span>
};
&nbsp;
GIFEncoder.prototype.writeShort = <span class="fstat-no" title="function not covered" >function(pValue) {</span>
<span class="cstat-no" title="statement not covered" >  this.out.writeByte(pValue &amp; 0xFF);</span>
<span class="cstat-no" title="statement not covered" >  this.out.writeByte((pValue &gt;&gt; 8) &amp; 0xFF);</span>
};
&nbsp;
/*
  Encodes and writes pixel data
*/
GIFEncoder.prototype.writePixels = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >  var enc = new LZWEncoder(this.width, this.height, this.indexedPixels, this.colorDepth);</span>
<span class="cstat-no" title="statement not covered" >  enc.encode(this.out);</span>
};
&nbsp;
module.exports = GIFEncoder;
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Tue Apr 18 2017 03:41:08 GMT+0000 (UTC)</div>
</div>
</body>
</html>
