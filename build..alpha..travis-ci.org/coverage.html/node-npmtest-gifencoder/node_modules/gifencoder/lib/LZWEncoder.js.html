<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-gifencoder/node_modules/gifencoder/lib/LZWEncoder.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-gifencoder">npmtest-gifencoder (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-gifencoder/node_modules/gifencoder/lib/LZWEncoder.js</span></h1>
    <h2>
        
        Statements: <span class="metric">13.04% <small>(15 / 115)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 30)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 10)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">14.15% <small>(15 / 106)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-gifencoder/node_modules/gifencoder/lib/</a> &#187; LZWEncoder.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/*
  LZWEncoder.js
&nbsp;
  Authors
  Kevin Weiner (original Java version - kweiner@fmsware.com)
  Thibault Imbert (AS3 version - bytearray.org)
  Johan Nordberg (JS version - code@johan-nordberg.com)
&nbsp;
  Acknowledgements
  GIFCOMPR.C - GIF Image compression routines
  Lempel-Ziv compression based on 'compress'. GIF modifications by
  David Rowley (mgardi@watdcsu.waterloo.edu)
  GIF Image compression - modified 'compress'
  Based on: compress.c - File compression ala IEEE Computer, June 1984.
  By Authors: Spencer W. Thomas (decvax!harpo!utah-cs!utah-gr!thomas)
  Jim McKie (decvax!mcvax!jim)
  Steve Davies (decvax!vax135!petsd!peora!srd)
  Ken Turkowski (decvax!decwrl!turtlevax!ken)
  James A. Woods (decvax!ihnp4!ames!jaw)
  Joe Orost (decvax!vax135!petsd!joe)
*/
&nbsp;
var EOF = -1;
var BITS = 12;
var HSIZE = 5003; // 80% occupancy
var masks = [0x0000, 0x0001, 0x0003, 0x0007, 0x000F, 0x001F,
             0x003F, 0x007F, 0x00FF, 0x01FF, 0x03FF, 0x07FF,
             0x0FFF, 0x1FFF, 0x3FFF, 0x7FFF, 0xFFFF];
&nbsp;
<span class="fstat-no" title="function not covered" >function LZWEncoder(width, height, pixels, colorDepth) {</span>
<span class="cstat-no" title="statement not covered" >  var initCodeSize = Math.max(2, colorDepth);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var accum = new Uint8Array(256);</span>
<span class="cstat-no" title="statement not covered" >  var htab = new Int32Array(HSIZE);</span>
<span class="cstat-no" title="statement not covered" >  var codetab = new Int32Array(HSIZE);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var cur_accum, cur_bits = 0;</span>
<span class="cstat-no" title="statement not covered" >  var a_count;</span>
<span class="cstat-no" title="statement not covered" >  var free_ent = 0; </span>// first unused entry
<span class="cstat-no" title="statement not covered" >  var maxcode;</span>
&nbsp;
  // block compression parameters -- after all codes are used up,
  // and compression rate changes, start over.
<span class="cstat-no" title="statement not covered" >  var clear_flg = false;</span>
&nbsp;
  // Algorithm: use open addressing double hashing (no chaining) on the
  // prefix code / next character combination. We do a variant of Knuth's
  // algorithm D (vol. 3, sec. 6.4) along with G. Knott's relatively-prime
  // secondary probe. Here, the modular division first probe is gives way
  // to a faster exclusive-or manipulation. Also do block compression with
  // an adaptive reset, whereby the code table is cleared when the compression
  // ratio decreases, but after the table fills. The variable-length output
  // codes are re-sized at this point, and a special CLEAR code is generated
  // for the decompressor. Late addition: construct the table according to
  // file size for noticeable speed improvement on small files. Please direct
  // questions about this implementation to ames!jaw.
<span class="cstat-no" title="statement not covered" >  var g_init_bits, ClearCode, EOFCode;</span>
&nbsp;
  // Add a character to the end of the current packet, and if it is 254
  // characters, flush the packet to disk.
<span class="fstat-no" title="function not covered" >  function char_out(c, outs) {</span>
<span class="cstat-no" title="statement not covered" >    accum[a_count++] = c;</span>
<span class="cstat-no" title="statement not covered" >    if (a_count &gt;= 254) <span class="cstat-no" title="statement not covered" >flush_char(outs);</span></span>
  }
&nbsp;
  // Clear out the hash table
  // table clear for block compress
<span class="fstat-no" title="function not covered" >  function cl_block(outs) {</span>
<span class="cstat-no" title="statement not covered" >    cl_hash(HSIZE);</span>
<span class="cstat-no" title="statement not covered" >    free_ent = ClearCode + 2;</span>
<span class="cstat-no" title="statement not covered" >    clear_flg = true;</span>
<span class="cstat-no" title="statement not covered" >    output(ClearCode, outs);</span>
  }
&nbsp;
  // Reset code table
<span class="fstat-no" title="function not covered" >  function cl_hash(hsize) {</span>
<span class="cstat-no" title="statement not covered" >    for (var i = 0; i &lt; hsize; ++i) <span class="cstat-no" title="statement not covered" >htab[i] = -1;</span></span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  function compress(init_bits, outs) {</span>
<span class="cstat-no" title="statement not covered" >    var fcode, c, i, ent, disp, hsize_reg, hshift;</span>
&nbsp;
    // Set up the globals: g_init_bits - initial number of bits
<span class="cstat-no" title="statement not covered" >    g_init_bits = init_bits;</span>
&nbsp;
    // Set up the necessary values
<span class="cstat-no" title="statement not covered" >    clear_flg = false;</span>
<span class="cstat-no" title="statement not covered" >    n_bits = g_init_bits;</span>
<span class="cstat-no" title="statement not covered" >    maxcode = MAXCODE(n_bits);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    ClearCode = 1 &lt;&lt; (init_bits - 1);</span>
<span class="cstat-no" title="statement not covered" >    EOFCode = ClearCode + 1;</span>
<span class="cstat-no" title="statement not covered" >    free_ent = ClearCode + 2;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    a_count = 0; </span>// clear packet
&nbsp;
<span class="cstat-no" title="statement not covered" >    ent = nextPixel();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    hshift = 0;</span>
<span class="cstat-no" title="statement not covered" >    for (fcode = HSIZE; fcode &lt; 65536; fcode *= 2) <span class="cstat-no" title="statement not covered" >++hshift;</span></span>
<span class="cstat-no" title="statement not covered" >    hshift = 8 - hshift; </span>// set hash code range bound
<span class="cstat-no" title="statement not covered" >    hsize_reg = HSIZE;</span>
<span class="cstat-no" title="statement not covered" >    cl_hash(hsize_reg); </span>// clear hash table
&nbsp;
<span class="cstat-no" title="statement not covered" >    output(ClearCode, outs);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    outer_loop: <span class="cstat-no" title="statement not covered" >while ((c = nextPixel()) != EOF) {</span></span>
<span class="cstat-no" title="statement not covered" >      fcode = (c &lt;&lt; BITS) + ent;</span>
<span class="cstat-no" title="statement not covered" >      i = (c &lt;&lt; hshift) ^ ent; </span>// xor hashing
<span class="cstat-no" title="statement not covered" >      if (htab[i] === fcode) {</span>
<span class="cstat-no" title="statement not covered" >        ent = codetab[i];</span>
<span class="cstat-no" title="statement not covered" >        continue;</span>
      } else <span class="cstat-no" title="statement not covered" >if (htab[i] &gt;= 0) { // non-empty slot</span>
<span class="cstat-no" title="statement not covered" >        disp = hsize_reg - i; </span>// secondary hash (after G. Knott)
<span class="cstat-no" title="statement not covered" >        if (i === 0) <span class="cstat-no" title="statement not covered" >disp = 1;</span></span>
<span class="cstat-no" title="statement not covered" >        do {</span>
<span class="cstat-no" title="statement not covered" >          if ((i -= disp) &lt; 0) <span class="cstat-no" title="statement not covered" >i += hsize_reg;</span></span>
<span class="cstat-no" title="statement not covered" >          if (htab[i] === fcode) {</span>
<span class="cstat-no" title="statement not covered" >            ent = codetab[i];</span>
<span class="cstat-no" title="statement not covered" >            continue outer_loop;</span>
          }
        } while (htab[i] &gt;= 0);
      }
<span class="cstat-no" title="statement not covered" >      output(ent, outs);</span>
<span class="cstat-no" title="statement not covered" >      ent = c;</span>
<span class="cstat-no" title="statement not covered" >      if (free_ent &lt; 1 &lt;&lt; BITS) {</span>
<span class="cstat-no" title="statement not covered" >        codetab[i] = free_ent++; </span>// code -&gt; hashtable
<span class="cstat-no" title="statement not covered" >        htab[i] = fcode;</span>
      } else {
<span class="cstat-no" title="statement not covered" >        cl_block(outs);</span>
      }
    }
&nbsp;
    // Put out the final code.
<span class="cstat-no" title="statement not covered" >    output(ent, outs);</span>
<span class="cstat-no" title="statement not covered" >    output(EOFCode, outs);</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  function encode(outs) {</span>
<span class="cstat-no" title="statement not covered" >    outs.writeByte(initCodeSize); </span>// write "initial code size" byte
<span class="cstat-no" title="statement not covered" >    remaining = width * height; </span>// reset navigation variables
<span class="cstat-no" title="statement not covered" >    curPixel = 0;</span>
<span class="cstat-no" title="statement not covered" >    compress(initCodeSize + 1, outs); </span>// compress and write the pixel data
<span class="cstat-no" title="statement not covered" >    outs.writeByte(0); </span>// write block terminator
  }
&nbsp;
  // Flush the packet to disk, and reset the accumulator
<span class="fstat-no" title="function not covered" >  function flush_char(outs) {</span>
<span class="cstat-no" title="statement not covered" >    if (a_count &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >      outs.writeByte(a_count);</span>
<span class="cstat-no" title="statement not covered" >      outs.writeBytes(accum, 0, a_count);</span>
<span class="cstat-no" title="statement not covered" >      a_count = 0;</span>
    }
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  function MAXCODE(n_bits) {</span>
<span class="cstat-no" title="statement not covered" >    return (1 &lt;&lt; n_bits) - 1;</span>
  }
&nbsp;
  // Return the next pixel from the image
<span class="fstat-no" title="function not covered" >  function nextPixel() {</span>
<span class="cstat-no" title="statement not covered" >    if (remaining === 0) <span class="cstat-no" title="statement not covered" >return EOF;</span></span>
<span class="cstat-no" title="statement not covered" >    --remaining;</span>
<span class="cstat-no" title="statement not covered" >    var pix = pixels[curPixel++];</span>
<span class="cstat-no" title="statement not covered" >    return pix &amp; 0xff;</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  function output(code, outs) {</span>
<span class="cstat-no" title="statement not covered" >    cur_accum &amp;= masks[cur_bits];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (cur_bits &gt; 0) <span class="cstat-no" title="statement not covered" >cur_accum |= (code &lt;&lt; cur_bits);</span></span>
    else <span class="cstat-no" title="statement not covered" >cur_accum = code;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    cur_bits += n_bits;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    while (cur_bits &gt;= 8) {</span>
<span class="cstat-no" title="statement not covered" >      char_out((cur_accum &amp; 0xff), outs);</span>
<span class="cstat-no" title="statement not covered" >      cur_accum &gt;&gt;= 8;</span>
<span class="cstat-no" title="statement not covered" >      cur_bits -= 8;</span>
    }
&nbsp;
    // If the next entry is going to be too big for the code size,
    // then increase it, if possible.
<span class="cstat-no" title="statement not covered" >    if (free_ent &gt; maxcode || clear_flg) {</span>
<span class="cstat-no" title="statement not covered" >      if (clear_flg) {</span>
<span class="cstat-no" title="statement not covered" >        maxcode = MAXCODE(n_bits = g_init_bits);</span>
<span class="cstat-no" title="statement not covered" >        clear_flg = false;</span>
      } else {
<span class="cstat-no" title="statement not covered" >        ++n_bits;</span>
<span class="cstat-no" title="statement not covered" >        if (n_bits == BITS) <span class="cstat-no" title="statement not covered" >maxcode = 1 &lt;&lt; BITS;</span></span>
        else <span class="cstat-no" title="statement not covered" >maxcode = MAXCODE(n_bits);</span>
      }
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (code == EOFCode) {</span>
      // At EOF, write the rest of the buffer.
<span class="cstat-no" title="statement not covered" >      while (cur_bits &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >        char_out((cur_accum &amp; 0xff), outs);</span>
<span class="cstat-no" title="statement not covered" >        cur_accum &gt;&gt;= 8;</span>
<span class="cstat-no" title="statement not covered" >        cur_bits -= 8;</span>
      }
<span class="cstat-no" title="statement not covered" >      flush_char(outs);</span>
    }
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.encode = encode;</span>
}
&nbsp;
module.exports = LZWEncoder;
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Tue Apr 25 2017 06:46:10 GMT+0000 (UTC)</div>
</div>
</body>
</html>
